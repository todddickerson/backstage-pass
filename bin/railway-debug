#!/bin/bash

echo "ðŸš‚ Railway Deployment Diagnostics"
echo "=================================="

echo ""
echo "ðŸ“Š Railway Status:"
railway status

echo ""
echo "ðŸ”— Project Services:"
railway service

echo ""
echo "ðŸ“‹ Environment Variables:"
railway variables

echo ""
echo "ðŸ”„ Recent Deployments:"
railway logs || echo "âŒ No deployment logs available"

echo ""
echo "ðŸŒ Domain Status:"
railway domain

echo ""
echo "ðŸ¥ Health Check:"
echo "Testing: https://backstage-pass-production.up.railway.app/health"
curl -s -I https://backstage-pass-production.up.railway.app/health | head -5

echo ""
echo "ðŸ  Root Path:"
echo "Testing: https://backstage-pass-production.up.railway.app/"
curl -s -I https://backstage-pass-production.up.railway.app/ | head -5

echo ""
echo "ðŸ“ Local Rails Check:"
echo "Checking if Rails can boot locally..."
if bundle exec rails runner "puts 'Rails boots successfully'" 2>/dev/null; then
    echo "âœ… Rails boots locally"
else
    echo "âŒ Rails fails to boot locally"
    echo "Error output:"
    bundle exec rails runner "puts 'Rails boots successfully'" 2>&1 | head -10
fi

echo ""
echo "ðŸ”§ Recommendations:"
echo "1. Check Railway dashboard for build/deployment logs"
echo "2. Ensure PostgreSQL service is connected"
echo "3. Verify environment variables are set"
echo "4. Check if DATABASE_URL is automatically provided"