#!/usr/bin/env bash

# Watch for changes to application.backstage_pass.css and copy to standard names
SOURCE="app/assets/builds/application.backstage_pass.css"

echo "üëÄ Watching $SOURCE for changes..."

# Initial copy
if [ -f "$SOURCE" ]; then
  cp "$SOURCE" app/assets/builds/application.css
  cp "$SOURCE" app/assets/builds/application.light.css
  echo "‚úÖ Initial CSS copied"
fi

# Watch for changes (macOS fswatch or Linux inotifywait)
if command -v fswatch &> /dev/null; then
  fswatch -o "$SOURCE" | while read; do
    cp "$SOURCE" app/assets/builds/application.css
    cp "$SOURCE" app/assets/builds/application.light.css
    echo "‚úÖ CSS updated: $(date '+%H:%M:%S')"
  done
else
  echo "‚ö†Ô∏è  fswatch not found. Install with: brew install fswatch"
  # Fallback: poll every 2 seconds
  while true; do
    sleep 2
    if [ -f "$SOURCE" ]; then
      cp "$SOURCE" app/assets/builds/application.css
      cp "$SOURCE" app/assets/builds/application.light.css
    fi
  done
fi
